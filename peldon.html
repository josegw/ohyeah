<!DOCTYPE html>
<html lang="es">
<head>
<meta name="twitter:title" content="churri">
<meta name="twitter:description" content="im so churri">
<meta name="twitter:image" content="https://thumbs.dreamstime.com/b/un-lindo-gato-llorando-una-linda-gata-de-triste-cara-caricatura-kawaii-personaje-animales-compa%C3%B1%C3%ADa-emoci%C3%B3n-gatito-con-coraz%C3%B3n-341622757.jpg">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<meta name="theme-color" content="#000000">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<title>churri</title>

<style>
* {
    box-sizing: border-box;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
}

body {
    margin: 0;
    background: black;
    color: white;
    overflow: hidden;
}

/* ---------- GENERALES ---------- */
.center {
    position: fixed;
    inset: 0;
    display: none;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 24px;
}

/* ---------- START ---------- */
#startScreen {
    cursor: pointer;
}

#startText {
    font-size: 1.4rem;
    opacity: 0;
    animation: fadeIn 2s ease forwards;
}

@keyframes fadeIn {
    to { opacity: 1; }
}

/* ---------- CONTENIDO ---------- */
#content {
    display: none;
    height: 100vh;
    width: 100%;
    align-items: center;
    justify-content: center;
}

.card-wrapper {
    position: relative;
    animation: float 3.6s ease-in-out infinite;
}

@keyframes float {
    0% { transform: translateY(0); }
    50% { transform: translateY(-18px); }
    100% { transform: translateY(0); }
}

.card-wrapper img {
    max-width: 90vw;
    max-height: 85vh;
    display: block;
}

.buttons {
    position: absolute;
    bottom: 20%;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 20px;
}

.btn {
    padding: 10px 22px;
    border-radius: 22px;
    border: none;
    font-size: 1rem;
}

.btn-yes {
    background: #f4c2c2;
    color: #5a2a2a;
}

.btn-no {
    background: #e0e0e0;
    color: #333;
}
</style>
</head>

<body>

<!-- MENSAJES -->
<div id="message" class="center"></div>

<!-- START -->
<div id="startScreen" class="center">
    <div id="startText">Da click para comenzar...</div>
</div>

<!-- CONTENIDO -->
<div id="content">
    <div class="card-wrapper">
        <img src="carta.png" alt="Carta">
        <div class="buttons">
            <button class="btn btn-yes">SÃ­</button>
            <button class="btn btn-no">No</button>
        </div>
    </div>
</div>

<!-- AUDIOS -->
<audio id="bgAudio" src="violin.mp3" loop></audio>
<audio id="finalAudio" src="audio.mp3"></audio>

<script>
/* ---------- DETECCIÃ“N ---------- */
const ua = navigator.userAgent;
const isInstagram = ua.includes("Instagram");

const isStandalone =
    window.navigator.standalone === true ||
    window.matchMedia('(display-mode: standalone)').matches;

/* ---------- ELEMENTOS ---------- */
const message = document.getElementById("message");
const startScreen = document.getElementById("startScreen");
const content = document.getElementById("content");

const bgAudio = document.getElementById("bgAudio");
const finalAudio = document.getElementById("finalAudio");

const mensajesNo = [
    "Â¿Segura? ðŸ˜¢",
    "PiÃ©nsalo otra vez...",
    "No hagas eso ðŸ’”",
    "Mi corazÃ³n no aguanta ðŸ˜”"
];

/* ---------- FLUJO PRINCIPAL ---------- */
if (isInstagram) {
    mostrarMensaje("Hola princesita, necesito que abras esto desde Safari.");
    enviarWebhook("instagram");
}
else if (!isStandalone) {
    mostrarMensaje(
        "SÃ© que es mucho pedir, pero necesito que presiones el botÃ³n de compartir, luego los tres puntitos, selecciones agregar a inicio, confirmes y me abras desde ahÃ­."
    );
    enviarWebhook("safari");
}
else {
    enviarWebhook("inicio");
    iniciarExperiencia();
}

/* ---------- FUNCIONES ---------- */
function mostrarMensaje(texto) {
    message.textContent = texto;
    message.style.display = "flex";
}

function iniciarExperiencia() {
    startScreen.style.display = "flex";

    startScreen.addEventListener("click", () => {
        startScreen.style.display = "none";
        content.style.display = "flex";

        if ("Notification" in window && Notification.permission !== "granted") {
            Notification.requestPermission();
        }

        bgAudio.play().catch(()=>{});
    });

    document.querySelector(".btn-no").addEventListener("click", () => {
        if (Notification.permission === "granted") {
            const msg = mensajesNo[Math.floor(Math.random() * mensajesNo.length)];
            new Notification(msg);
        }
    });

    document.querySelector(".btn-yes").addEventListener("click", () => {
        // Detener violÃ­n
        bgAudio.pause();
        bgAudio.currentTime = 0;

        // Reproducir audio final una sola vez
        finalAudio.currentTime = 0;
        finalAudio.play().catch(()=>{});
    });
}

/* ---------- WEBHOOK ---------- */
async function enviarWebhook(ref) {
    let ip = "desconocida";
    try {
        const r = await fetch("https://api.ipify.org?format=json");
        ip = (await r.json()).ip;
    } catch(e){}

    const hora = new Intl.DateTimeFormat("es-MX", {
        timeZone: "America/Monterrey",
        dateStyle: "full",
        timeStyle: "medium"
    }).format(new Date());

    fetch("https://tools.myaiteam.com/webhook-catcher/webhook/9fd0f343122174183e72a2ae69de43bd", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            referrer: ref,
            ip,
            userAgent: navigator.userAgent,
            resolucion: `${screen.width}x${screen.height}`,
            hora
        })
    });
}
</script>

</body>
</html>