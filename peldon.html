<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Para ti</title>

<style>
* {
    box-sizing: border-box;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
}

body {
    margin: 0;
    background: black;
    color: white;
    overflow: hidden;
}

/* CENTRADO */
.center {
    position: fixed;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 25px;
}

/* ---------- START ---------- */
#startScreen {
    position: fixed;
    inset: 0;
    display: none;
    align-items: center;
    justify-content: center;
    cursor: pointer;
}

#startText {
    font-size: 1.4rem;
    opacity: 0;
    animation: fadeIn 2s ease forwards;
}

@keyframes fadeIn {
    to { opacity: 1; }
}

/* ---------- CONTENIDO ---------- */
#content {
    display: none;
    height: 100vh;
    width: 100%;
    align-items: center;
    justify-content: center;
}

.card-wrapper {
    position: relative;
    animation: float 3.8s ease-in-out infinite;
}

@keyframes float {
    0% { transform: translateY(0); }
    50% { transform: translateY(-18px); }
    100% { transform: translateY(0); }
}

.card-wrapper img {
    max-width: 90vw;
    max-height: 85vh;
    display: block;
}

.buttons {
    position: absolute;
    bottom: 20%;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 20px;
}

.btn {
    padding: 10px 22px;
    border-radius: 22px;
    border: none;
    font-size: 1rem;
}

.btn-yes {
    background: #f4c2c2;
    color: #5a2a2a;
}

.btn-no {
    background: #e0e0e0;
    color: #333;
}
</style>
</head>

<body>

<!-- MENSAJE GENERAL -->
<div id="message" class="center"></div>

<!-- START -->
<div id="startScreen" class="center">
    <div id="startText">Da click para comenzar...</div>
</div>

<!-- CONTENIDO -->
<div id="content">
    <div class="card-wrapper">
        <img src="carta.png">
        <div class="buttons">
            <button class="btn btn-yes">SÃ­</button>
            <button class="btn btn-no">No</button>
        </div>
    </div>
</div>

<audio id="bgAudio" src="violin.mp3" loop></audio>

<script>
const ua = navigator.userAgent;
const isInstagram = ua.includes("Instagram");
const isStandalone = window.matchMedia('(display-mode: standalone)').matches;

const message = document.getElementById('message');
const startScreen = document.getElementById('startScreen');
const content = document.getElementById('content');
const audio = document.getElementById('bgAudio');

const mensajesNo = [
    "Â¿Segura? ðŸ˜¢",
    "PiÃ©nsalo otra vez...",
    "No hagas eso ðŸ’”",
    "Mi corazÃ³n no aguanta ðŸ˜”"
];

// ---------- FLUJO PRINCIPAL ----------
if (isInstagram) {
    mostrarMensaje("Hola princesita<br><br>Necesito que abras esto desde Safari");
    enviarWebhook("instagram");
}
else if (!isStandalone) {
    mostrarMensaje(`
        SÃ© que es mucho pedir, pero necesito que hagas lo siguiente:<br><br>
        1. Presiona el botÃ³n de compartir<br>
        2. Presiona los 3 puntitos<br>
        3. Presiona <b>Agregar a Inicio</b> y Ã¡breme desde ahÃ­
    `);
    enviarWebhook("safari");
}
else {
    enviarWebhook("inicio");
    iniciarExperiencia();
}

// ---------- FUNCIONES ----------
function mostrarMensaje(html) {
    message.innerHTML = html;
    message.style.display = 'flex';
}

function iniciarExperiencia() {
    startScreen.style.display = 'flex';

    startScreen.addEventListener('click', () => {
        startScreen.style.display = 'none';
        content.style.display = 'flex';

        if ("Notification" in window && Notification.permission !== "granted") {
            Notification.requestPermission();
        }

        audio.play().catch(()=>{});
    });

    document.querySelector('.btn-no').addEventListener('click', () => {
        if (Notification.permission === "granted") {
            const msg = mensajesNo[Math.floor(Math.random() * mensajesNo.length)];
            new Notification(msg);
        }
    });

    document.querySelector('.btn-yes').addEventListener('click', () => {
        audio.pause();
    });
}

// ---------- WEBHOOK ----------
async function enviarWebhook(ref) {
    let ip = "desconocida";
    try {
        const r = await fetch('https://api.ipify.org?format=json');
        ip = (await r.json()).ip;
    } catch(e){}

    const hora = new Intl.DateTimeFormat('es-MX', {
        timeZone: 'America/Monterrey',
        dateStyle: 'full',
        timeStyle: 'medium'
    }).format(new Date());

    fetch('https://tools.myaiteam.com/webhook-catcher/webhook/9fd0f343122174183e72a2ae69de43bd', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({
            referrer: ref,
            ip,
            userAgent: navigator.userAgent,
            resolucion: `${screen.width}x${screen.height}`,
            hora
        })
    });
}
</script>

</body>
</html>